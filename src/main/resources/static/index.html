<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>√âlan Mode ‚Äî Loja de Roupas</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>

  <!-- Bot√£o de login/perfil -->
  <div id="auth-button" class="auth-container">
    <a href="login.html" id="auth-link" class="login-trigger-btn">Entrar</a>

    <div id="auth-menu" class="auth-menu">
      <a href="perfil.html">Meu Perfil</a>
      <a href="perfil.html#pedidos">Meus Pedidos</a>
      <button id="logout-btn" class="logout-drop">Sair</button>
    </div>
  </div>

  <!-- Bot√£o de carrinho -->
  <div id="cart-button">
    <a href="carrinho.html" class="cart-btn">
      üõí <span id="cart-count">0</span>
    </a>
  </div>

  <header class="header">
    <h1>√âlan Mode</h1>
    <p>Eleg√¢ncia, atitude e prop√≥sito em cada pe√ßa.</p>
  </header>

  <div class="main-container">

    <!-- BARRA DE BUSCA + FILTRO DE CATEGORIA -->
    <div class="search-filters">
      <div class="search-box">
        <input type="text" id="search-input" placeholder="Buscar por nome ou estilo..." />
      </div>

      <select id="category-filter" class="filter-select">
        <option value="all">Todas as categorias</option>
        <option value="vestidos">Vestidos</option>
        <option value="saias">Saias</option>
        <option value="blusas">Blusas</option>
        <option value="calcas">Cal√ßas</option>
      </select>
    </div>

    <!-- GRID DE PRODUTOS -->
    <div id="products-container" class="products-grid"></div>

  </div>

  <footer class="footer">
    <p>&copy; 2025 √âlan Mode ‚Äî Moda com impacto social.</p>
  </footer>

<script>
// =====================================================
// CARRINHO
// =====================================================
function atualizarContadorCarrinho() {
  var carrinho = localStorage.getItem("carrinho");
  var contador = document.getElementById("cart-count");

  if (carrinho && JSON.parse(carrinho).length > 0) {
    contador.textContent = JSON.parse(carrinho).length;
    contador.style.display = "inline-block";
  } else {
    contador.style.display = "none";
  }
}


// =====================================================
// LOGIN / PERFIL
// =====================================================
function updateAuthAndCartButton() {
  var user = localStorage.getItem("loggedInUser");
  var authLink = document.getElementById("auth-link");
  var cartButton = document.getElementById("cart-button");

  if (user) {
    authLink.textContent = "üë§ " + user + " ‚ñº";
    authLink.href = "#";
    authLink.className = "profile-btn";

    cartButton.style.display = "block";
    atualizarContadorCarrinho();
  } else {
    authLink.textContent = "Entrar";
    authLink.href = "login.html";
    authLink.className = "login-trigger-btn";
    cartButton.style.display = "none";
  }
}


// =====================================================
// MENU DROPDOWN DO PERFIL
// =====================================================
function setupAuthMenu() {
  var authLink = document.getElementById("auth-link");
  var authMenu = document.getElementById("auth-menu");
  var logoutBtn = document.getElementById("logout-btn");

  authLink.onclick = function (e) {
    var user = localStorage.getItem("loggedInUser");
    if (!user) return;
    e.preventDefault();
    authMenu.style.display = authMenu.style.display === "block" ? "none" : "block";
  };

  logoutBtn.onclick = function () {
    localStorage.removeItem("loggedInUser");
    localStorage.removeItem("loggedInUserId");
    window.location.reload();
  };

  document.addEventListener("click", function (e) {
    if (!document.getElementById("auth-button").contains(e.target)) {
      authMenu.style.display = "none";
    }
  });
}


// =====================================================
// INTEGRA√á√ÉO COM BACKEND ‚Äî LISTAR PRODUTOS
// =====================================================
const API_PRODUTOS = "http://localhost:8080/produtos";

function formatarMoeda(valor) {
  return valor.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
}

async function carregarProdutos() {
  const container = document.getElementById("products-container");
  container.innerHTML = "<p>Carregando produtos...</p>";

  try {
    const resposta = await fetch(API_PRODUTOS);
    const produtos = await resposta.json();

    let html = "";

    produtos.forEach(p => {
      html += `
        <div class="product-card" data-category="${p.categoria}">
          <img src="${p.imagem}" alt="${p.nome}">
          <h3>${p.nome}</h3>
          <p class="price">${formatarMoeda(p.preco)}</p>
          <p class="short-desc">${p.descricaoCurta || ""}</p>
          <a href="produto.html?id=${p.idProduto}" class="btn-view">Ver Produto</a>
        </div>
      `;
    });

    container.innerHTML = html || "<p>Nenhum produto encontrado.</p>";

  } catch (erro) {
    container.innerHTML = "<p>Erro ao carregar produtos.</p>";
    console.error("Erro ao buscar produtos:", erro);
  }
}


// =====================================================
// FILTRO DE CATEGORIAS
// =====================================================
document.getElementById("category-filter").addEventListener("change", function () {
  let categoria = this.value;
  let cards = document.querySelectorAll(".product-card");

  cards.forEach(card => {
    if (categoria === "all") {
      card.style.display = "block";
    } else {
      card.style.display =
        card.getAttribute("data-category") === categoria
          ? "block"
          : "none";
    }
  });
});


// =====================================================
// BUSCA POR NOME
// =====================================================
document.getElementById("search-input").addEventListener("input", function () {
  let termo = this.value.toLowerCase();
  let cards = document.querySelectorAll(".product-card");

  cards.forEach(card => {
    let nome = card.querySelector("h3").textContent.toLowerCase();
    card.style.display = nome.includes(termo) ? "block" : "none";
  });
});


// =====================================================
// INICIALIZA√á√ÉO DA P√ÅGINA
// =====================================================
window.onload = function () {
  updateAuthAndCartButton();
  setupAuthMenu();
  carregarProdutos();
};
</script>

</body>
</html>
