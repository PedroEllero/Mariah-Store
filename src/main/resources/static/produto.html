<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Produto ‚Äî Mariah store</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <div id="toast" class="toast"></div>

  
  <div class="top-nav">
    <a href="index.html" class="nav-btn">‚Üê Voltar</a>

    <div class="nav-right">
      <a href="carrinho.html" class="nav-icon">üõí</a>
      <a href="perfil.html" class="nav-icon">üë§</a>
    </div>
  </div>

 
  <header class="header">
    <h1>Mariah store</h1>
    <p>Detalhes do produto</p>
  </header>

  
  <main class="main-container">

    <div class="product-detail">

     
      <div class="product-image-box">
        <img id="product-img" src="imagens/default.jpg" alt="Imagem do produto" class="product-image">
      </div>

      
      <div class="product-info-box">

        <h2 id="product-name" class="product-title">Carregando...</h2>

        <p id="product-price-unit" class="product-price">R$ 0,00</p>

        <p id="product-description" class="product-description">
          Carregando descri√ß√£o...
        </p>

        
        <div class="product-section">
          <h3 class="section-title">Tamanho</h3>
          <div id="sizes-container" class="sizes"></div>
          <input type="hidden" id="selected-size">
        </div>

        <div class="product-section">
          <h3 class="section-title">Quantidade</h3>
          <div id="quantities-container" class="quantities"></div>
          <input type="hidden" id="selected-quantity" value="1">
        </div>

        <p id="product-price-total" class="product-total">
          Total: R$ 0,00
        </p>

        <button class="btn-primary" onclick="comprarProduto()">Comprar</button>

        <button class="btn-cart" id="add-cart-btn" onclick="adicionarAoCarrinho()">
          Adicionar ao carrinho
        </button>

      </div>
    </div>

  </main>

  
  <footer class="footer">
    <p>&copy; 2025 Mariah store ‚Äî Moda com impacto social.</p>
  </footer>

  
  <script>
    const API_PRODUTOS = "http://localhost:8080/produtos";
    const tamanhos = ["PP", "P", "M", "G", "GG"];
    const quantidades = [1, 2, 3, 4];

  
    function showToast(msg) {
      const toast = document.getElementById("toast");
      toast.textContent = msg;
      toast.classList.add("show");

      setTimeout(() => {
        toast.classList.remove("show");
      }, 2200);
    }

    function formatarMoeda(valor) {
      return valor.toLocaleString("pt-BR", { style: "currency", currency: "BRL" });
    }

   
    async function carregarProduto() {
      const id = parseInt(new URLSearchParams(window.location.search).get("id"));
      if (!id) {
        document.getElementById("product-name").textContent = "Produto n√£o encontrado";
        return;
      }

      const resp = await fetch(API_PRODUTOS);
      const produtos = await resp.json();
      const produto = produtos.find(p => p.idProduto === id);

      if (!produto) {
        document.getElementById("product-name").textContent = "Produto n√£o encontrado";
        return;
      }

      document.getElementById("product-name").textContent = produto.nome;
      document.getElementById("product-price-unit").textContent = formatarMoeda(produto.preco);
      document.getElementById("product-description").textContent = produto.descricao || "Descri√ß√£o n√£o dispon√≠vel.";
      document.getElementById("product-img").src = produto.imagem;

      document.body.dataset.preco = produto.preco;
      document.body.dataset.idProduto = produto.idProduto;
      document.body.dataset.nomeProduto = produto.nome;

      renderizarTamanhos();
      renderizarQuantidades();
      atualizarTotal();
    }

    function renderizarTamanhos() {
      const cont = document.getElementById("sizes-container");
      cont.innerHTML = "";

      tamanhos.forEach(t => {
        const b = document.createElement("button");
        b.textContent = t;
        b.className = "size-btn";
        b.onclick = () => {
          document.getElementById("selected-size").value = t;
          document.querySelectorAll(".size-btn").forEach(x => x.classList.remove("active"));
          b.classList.add("active");
        };
        cont.appendChild(b);
      });
    }

    function renderizarQuantidades() {
      const cont = document.getElementById("quantities-container");
      cont.innerHTML = "";

      quantidades.forEach(q => {
        const b = document.createElement("button");
        b.textContent = q;
        b.className = "qty-btn";
        b.onclick = () => {
          document.getElementById("selected-quantity").value = q;
          document.querySelectorAll(".qty-btn").forEach(x => x.classList.remove("active"));
          b.classList.add("active");
          atualizarTotal();
        };
        cont.appendChild(b);
      });
    }

    function atualizarTotal() {
      const preco = parseFloat(document.body.dataset.preco);
      const qtd = parseInt(document.getElementById("selected-quantity").value) || 1;
      const total = preco * qtd;
      document.getElementById("product-price-total").textContent = "Total: " + formatarMoeda(total);
    }

    function comprarProduto() {
      const tam = document.getElementById("selected-size").value;
      const qtd = parseInt(document.getElementById("selected-quantity").value);

      if (!tam) {
        showToast("Selecione um tamanho");
        return;
      }

      const item = {
        id: document.body.dataset.idProduto,
        nome: document.body.dataset.nomeProduto,
        tamanho: tam,
        quantidade: qtd,
        precoUnitario: parseFloat(document.body.dataset.preco)
      };

      localStorage.setItem("pedidoAtual", JSON.stringify(item));
      showToast("Compra iniciada!");
    }

function adicionarAoCarrinho() {
  const tamanho = document.getElementById("selected-size").value;
  const quantidade = parseInt(document.getElementById("selected-quantity").value);

  if (!tamanho) {
    showToast("Selecione um tamanho");
    return;
  }

  const idProduto = parseInt(new URLSearchParams(window.location.search).get("id"));
  const nomeProduto = document.getElementById("product-name").textContent;
  const precoUnitario = parseFloat(
    document.getElementById("product-price-unit").textContent
      .replace("R$", "")
      .replace(",", ".")
      .trim()
  );

  const item = {
    id: idProduto,
    name: nomeProduto,
    size: tamanho,
    quantity: quantidade,
    unitPrice: precoUnitario,
    totalPrice: precoUnitario * quantidade
  };

  let cart = JSON.parse(localStorage.getItem("cart") || "[]");
  cart.push(item);
  localStorage.setItem("cart", JSON.stringify(cart));

  showToast("Adicionado ao carrinho!");
}


    window.onload = carregarProduto;
  </script>

</body>

</html>
